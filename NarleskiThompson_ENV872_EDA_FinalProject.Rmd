---
title: "Fish Tissue Contamination and its Effects on Human and Ecosystem Health"
subtitle: "An examination of trends in fish tissue composition in the Great Lakes"
author: "Jaclyn Narleski and Victoria Thompson"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    theme: cosmo
    toc: true
    toc_depth: 2
    number_sections: true
    fig_caption: true
---
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
# Set your working directory
getwd()

# Load your packages
library(here)
library(lubridate)
library(tidyverse)
library(agricolae)
library(ggplot2)
library(sf)
library(gridExtra)
library(patchwork)
library(bookdown) #allows for autoreferencing
library(knitr) #allows for autoreferencing
library(stringr) #allows for fix to capitalization of fish names



# Check working directory
here()

# Set your ggplot theme
laketheme <- theme(
  panel.background = element_rect(fill = "gray90"),
  panel.border = element_rect(color = "darkcyan", fill = NA, linetype = 1),
  plot.title = element_text(
    hjust = 0.5, size = 12, color = "darkcyan", 
    face = "bold"),
  axis.title = element_text(size = 10, color = "darkcyan"),
  panel.grid.major = element_line(
    color = "aquamarine4", linetype = 2, size = 0.25),
  panel.grid.minor = element_line(
    color = "aquamarine3", linetype = 3, size = 0.25),
  axis.text = element_text(color = "aquamarine4"),
  axis.text.x = element_text(angle = 45, hjust = 1),
  axis.ticks = element_line(color = "aquamarine4"),
  legend.title = element_text(size = 8, color = "darkcyan"),
  legend.position = "right"
)

# Set theme
theme_set(laketheme)

# Load your datasets

# 2010 data
fattyacids_2010_raw <- read.csv("RawData/2010_FattyAcids_Raw.csv")
mercury_2010_raw <- read.csv("RawData/2010_Mercury_Raw.csv")
PCB_2010_raw <- read.csv("RawData/2010_PCBs_Raw.csv")
PFA_2010_raw <- read.csv("RawData/2010_PFAs_Raw.csv")

# 2015 data
fattyacids_2015_raw <- read.csv("RawData/2015_FattyAcids_Raw.csv")
mercury_2015_raw <- read.csv("RawData/2015_Mercury_Raw.csv")
PCB_2015_raw <- read.csv("RawData/2015_PCBs_Raw.csv")
PFA_2015_raw <- read.csv("RawData/2015_PFAs_Raw.csv")

# 2020 data
fattyacids_2020_raw <- read.csv("RawData/2020_FattyAcids_Raw.csv")
mercury_2020_raw <- read.csv("RawData/2020_Mercury_Raw.csv")
PCB_2020_raw <- read.csv("RawData/2020_PCBs_Raw.csv")
PFA_2020_raw <- read.csv("RawData/2020_PFAs_Raw.csv")

```

# Rationale and Research Questions
The Great Lakes, which collectively represent the largest surface freshwater system on Earth, are critical ecological and economic resources for millions of people. These lakes support diverse aquatic life, serve as a source of drinking water, provide recreational opportunities, and underpin industries such as fishing. However, over the past century, the Great Lakes have been threatened by environmental stressors, including pollution from industrial waste, agricultural runoff, and urban development.[1] The contaminants affecting these ecosystems pose serious risks to both aquatic life and human health.

Fish accumulate pollutants in their tissues, decreasing their health and altering ecological dynamics within the lakes. In 2010, the EPA launched the NCCA (National Coastal Condition Assessment) to “assess the condition of nearshore waters along the marine and Great Lakes coasts of the United States and to evaluate changes affecting the quality of these waters over time”.[2] This project includes sampling and testing fish tissues for particularly harmful long-lasting chemicals, including mercury, PFAS, PCBs, and fatty acids (Table \@ref(tab:contaminant-table) ). The EPA hopes that data on these contamination levels will allow them to be better informed on the current risks to fish, and the aquatic and human lives that depend on them.

Between the fragile ecosystems that depend on fish to the entire human populations to rely on them, studying contamination is of the utmost importance. This has led to the development of the following research questions to guide our investigation:

<ol><b>
  <li>Does average fish tissue contamination vary significantly between each lake within each sampling year?</li>
  <li>Does average fish tissue contamination of all lakes vary significantly between each sampling year?</li>
  <li>Are there trends in contaminant levels in each fish species over time?</li>
</b></ol>

```{r contaminant-table, echo=FALSE, message=FALSE}
contaminants <- data.frame(
  Contaminant = c("Mercury", "Fatty Acids", "PCBs", "PFAs"),
  Description = c(
    "A heavy metal that comes from sources such as factory outputs and landfill leaching",
    "Organic compounds found in the tissues of organisms; required in some amounts but negative in excess",
    "Industrial chemicals used in electrical equipment, plastics, and paints",
    "Man-made chemicals found in products that resist oil and grease (i.e. non-stick coatings) and fire-fighting foam"
  ),
  `Effect on Human Health` = c(
    "Reproductive, developmental, and sensory defects",
    "Excessive intake can lead to cardiovascular diseases",
    "Cancer, reproductive problems, and immune system suppression",
    "Associated with cancer, liver damage, thyroid disorders, and immune system suppression"
  )
)

names(contaminants) <- c("Contaminant", "Description", "Effect on Human Health")

kable(contaminants, caption = "Description of the contaminants used in this project." )

```

<br>
\newpage

# Dataset Information
The datasets used in this analysis were sourced from the Environmental Protection Agency (EPA) website. They were selected from available National Coastal Condition Assessments (NCCA), which are surveys designed to assess long-term conditions of nearshore waters along the coasts of the Great Lakes. Our data specifically involves the data collected from Fish Fillet Tissue studies, where samples of fish muscle from commonly caught recreational fish species are taken and analyzed for mercury, PFAs (per- & polyfluoroalkl substances), PCB (polychlorinated biphenyls) Congeners & Aroclors, and Omega-3 & Omega-6 fatty acids. The EPA uses the results from these studies to evaluate the water quality of the Great Lakes and more specifically, determine the health impacts humans may have from consuming fish caught in the Great Lakes.

Fish contaminant data is collected using the following procedures, per the 2020 NCCA Field Operations Manual:
- Sites are randomly selected along U.S. coasts of the Great Lakes
- Crews collect fish at all NCCA sites, yielding a minimum total of 300g total mass per target species
- Fish are identified, measured, labelled, frozen, and brough to a lab
- Specimens are cleaned to prevent contamination with non-marine chemicals
- Fish are filleted (scales are removed, but skin and belly are left intact)
- A variety of lab procedures are performed in accordance with EPA guidelines to determine the lipid content, concentrations of metals, pesticides, and PCBs in each fish

The Environmental Protection Agency has conducted periodic studies over the past 15 years assessing the coastal conditions of marine and the Great Lakes shores. We focus on data from 2010, 2015, and 2020. The basic structure of each is described below (Table \@ref(tab:columm-description-table) ). 

```{r columm-description-table, echo=FALSE, message=FALSE}

column_descriptions <- data.frame(
  `Column Name` = c(
    "EPA Region", "State", "Lake", "Site ID", 
    "EPA Sample ID", "Tissue Type", "% Lipids", 
    "Method", "Analyte", "Amount"
  ),
  Description = c(
    "The EPA Region in which the sample was collected",
    "2-letter abbreviation for the state in which the sample was collected",
    "The Great Lake the sample is from",
    '"NGL" + site selection year + state + 4-digit site location',
    "6-digit code assigned by the EPA",
    "The type of fish tissue used for analysis; we use only fillet data",
    "The lipid content of the sample, measured independently of the chemical analysis",
    "EPA-standardized method of chemical analysis",
    "The chemical of interest in each dataset",
    "Amount of chemical detected in the sample"
  )
)


# Generate the table
kable(
  column_descriptions, 
  caption = "Description of the columns in the dataset."
)

```

<br>
<p style="color: darkgray;">*adapted from 2020 GLHHFTS Fish Tissue Data Dictionary for Mercury, PCBs, and PFAS Results November 2023*.</p>

## Dataset Wrangling Procedures
<br>
Each of the 5-year publications from the EPA contains 4 separate data files arranged by contaminant (Mercury, PFAS, PCBs, Fatty Acids). There are also 3 metadata files and 3 quality assurance reports for each. [3] Each of the 4 separate contaminant data files were loaded into R as raw .xlsx files. The columns from Table \@ref(tab:columm-description-table) were selected from the raw file, and a new column was added for the collection year. This was repeated for all 12 datasets (4 contaminants for each of 3 years). There are slight variations in the dataset formatting between years, leading to differences in the pipe function to account for them. For example, some columns are renamed as to all have a consistent naming conventions. Each wrangled dataset was reassigned to a "processed" .csv file for analysis. **ADD MORE HERE- jaclyn can write about the issues/solutions to the weird datasets**
<br>
<br>
 
## Summary of Data Structure
<br>
The basic structure of each of the raw datasets can be found in Table \@ref(tab:columm-description-table). The specific variables being investigated from  each of the processed files can be found below (Table \@ref(tab:processed-description-table) ). They vary in units, described in Table \@ref(tab:contaminant-units-table). Additionally, while the total fatty acid content was combined, the types that were used for our specific study found in the data are listed along with their abbreviations (Table \@ref(tab:fatty-acids-table)). This is due to the fact that some of the analytes in the 2015 and 2020 fatty acid studies were not measured in the 2010 study, and do not have nearly as much research and information on their impacts in comparison to the other analytes found in all 3 studies.
<br>
<br>
```{r processed-description-table, echo=FALSE, message=FALSE}
variable_descriptions <- data.frame(
  Variable = c(
    "State", "Lake", "Scientific.Name", "Common.Name", 
    "Family", "Niche", "Method", "Analyte", 
    "Amount", "Unit.1", "Unit.2"
  ),
  Description = c(
    "2-letter abbreviation for the state in which the sample was collected",
    "The Great Lake the sample is from",
    "Taxonomic name of fish sampled",
    "Common name of fish sampled",
    "Taxonomic family of fish sampled",
    'Codified ecological niche of the fish sampled; "BD" is "Benthic-Demersal", "P" is "Pelagic"',
    "EPA-standardized method of chemical analysis",
    "The chemical of interest in each dataset",
    "Amount of chemical detected in the sample",
    "The original unit the chemical was measured in. See Table 3.3",
    "The amount of chemical converted to common units. Only for some contaminants. See Table 3.3"
  )
)

# Generate the table
kable(
  variable_descriptions, 
  caption = "Description of the variables in the dataset."
)

```

```{r contaminant-units-table, echo=FALSE, message=FALSE}
contaminant_units <- data.frame(
  Contaminant = c("Mercury", "Fatty Acids", "PCBs", "PFAs"),
  `Unit 1 (Original)` = c(
    "ng/g (nanograms per gram)", 
    "mg/g (milligrams per gram)", 
    "ng/g (nanograms per gram)", 
    "ng/g (nanograms per gram)"
  ),
  `Unit 2 (Converted)` = c(
    "ppb (parts per billion)", 
    "ug/g (micrograms per gram)", 
    "ppb (parts per billion)", 
    "ppb (parts per billion)"
  )
)

names(contaminant_units) <- c("Contaminant", "Unit 1 (Original)", "Unit 2 (Converted)")

# Generate the table
kable(
  contaminant_units, 
  caption = "Units of measurement for each contaminant."
)
```

```{r fatty-acids-table, echo=FALSE, message=FALSE}

fatty_acids <- data.frame(
  `Fatty Acid` = c(
    "alpha-Linolenic acid", "Docosahexaenoic acid", 
    "Docosapentaenoic acid", "Eicosapentaenoic acid", 
    "Eicosatrienoic acid", "Linolenic acid"
  ),
  Type = c("Omega-3", "Omega-3", "Omega-3", "Omega-3", "Omega-3", "Omega-6"),
  Abbreviation = c("ALA", "DHA", "DPA", "EPA", "ETE", "LA")
)

# Generate the table
kable(
  fatty_acids, 
  caption = "Types of fatty acids and their abbreviations."
)
```


```{r wrangling, echo=FALSE, warning=FALSE, message=FALSE}

# Wrangle mercury data and write in as csvs

mercury_2010_processed <- mercury_2010_raw %>%
  select(State, Lake.Name, Scientific.Name, Common.Name, Family, Niche,
         Analyte, Amount, Unit.1, Unit.2) %>%
  mutate(Year = rep(2010, nrow(mercury_2010_raw))) %>%
  rename(Lake = Lake.Name)

write.csv(mercury_2010_processed, 
"~/FinalProject/NarleskiThompson_ENV872_EDA_FinalProject/ProcessedData/2010_Mercury_Processed.csv")

mercury_2015_processed <- mercury_2015_raw %>%
  select(State, Lake, Scientific.Name, Common.Name, Family, Niche,
         Analyte, Amount, Unit.1, Unit.2) %>%
  mutate(Year = rep(2015, nrow(mercury_2015_raw)))

write.csv(mercury_2015_processed, "~/FinalProject/NarleskiThompson_ENV872_EDA_FinalProject/ProcessedData/2015_Mercury_Processed.csv")

mercury_2020_processed <- mercury_2020_raw %>%
  select(State, Lake, Scientific.Name, Common.Name, Family, Niche,
         Analyte, Amount, Units.1, Units.2) %>%
  mutate(Year = rep(2020, nrow(mercury_2020_raw)))

write.csv(mercury_2020_processed, 
"~/FinalProject/NarleskiThompson_ENV872_EDA_FinalProject/ProcessedData/2020_Mercury_Processed.csv")

# Wrangle PFAs data and write in as csvs

PFA_2010_processed <- PFA_2010_raw %>%
  select(State, Lake.Name, Scientific.Name, Common.Name, Family, Niche,
         Analyte, Amount, Unit.1, Unit.2) %>%
  mutate(Year = rep(2010, nrow(PFA_2010_raw)), Amount = coalesce(Amount, 0)) %>%
  rename(Lake = Lake.Name)

write.csv(PFA_2010_processed, "~/FinalProject/NarleskiThompson_ENV872_EDA_FinalProject/ProcessedData/2010_PFAs_Processed.csv")

PFA_2015_processed <- PFA_2015_raw %>%
  select(State, Lake, Scientific.Name, Common.Name, Family, Niche,
         Analyte, Amount, Unit.1, Unit.2) %>%
  mutate(Year = rep(2015, nrow(PFA_2015_raw)), Amount = coalesce(Amount, 0))

write.csv(PFA_2015_processed, "~/FinalProject/NarleskiThompson_ENV872_EDA_FinalProject/ProcessedData/2015_PFAs_Processed.csv")

PFA_2020_processed <- PFA_2020_raw %>%
  select(State, Lake, Scientific.Name, Common.Name, Family, Niche,
         Chemical, Amount, Units.1, Units.2) %>%
  mutate(Year = rep(2020, nrow(PFA_2020_raw)), Amount = coalesce(Amount, 0)) %>%
  rename(Analyte = Chemical)

write.csv(PFA_2020_processed, "~/FinalProject/NarleskiThompson_ENV872_EDA_FinalProject/ProcessedData/2020_PFAs_Processed.csv")

# Wrangle PCB data and write in as csvs

PCB_2010_processed <- PCB_2010_raw %>%
  select(State, Lake.Name, Species.Name, Common.Name, Family, Niche,
         Analyte, Amount, Unit.1, Unit.2) %>%
  filter(Analyte == "Total PCBs") %>%
  mutate(Year = 2010) %>%
  rename(Lake = Lake.Name,
         Scientific.Name = Species.Name)

write.csv(PCB_2010_processed, "~/FinalProject/NarleskiThompson_ENV872_EDA_FinalProject/ProcessedData/2010_PCBs_Processed.csv")

PCB_2015_processed <- PCB_2015_raw %>%
  select(State, Lake, Scientific.Name, Common.Name, Family, Niche,
         Analyte, Amount, Unit.1, Unit.2) %>%
  filter(Analyte == "Total PCBs") %>%
  mutate(Year = 2015)

write.csv(PCB_2015_processed, "~/FinalProject/NarleskiThompson_ENV872_EDA_FinalProject/ProcessedData/2015_PCBs_Processed.csv")

PCB_2020_processed <- PCB_2020_raw %>%
  select(State, Lake, Scientific.Name, Common.Name, Family, Niche,
         Analyte, Amount, Units.1, Units.2) %>%
  filter(Analyte == "Total PCBs") %>%
  mutate(Year = 2020)

write.csv(PCB_2020_processed, "~/FinalProject/NarleskiThompson_ENV872_EDA_FinalProject/ProcessedData/2020_PCBs_Processed.csv")

# Wrangle fatty acid data and write in as csvs

fattyacids_2010_processed <- fattyacids_2010_raw %>%
   select(State, Lake.Name, Species.ID, Scientific.Name, Common.Name, Family, Niche,
         Analyte, Abbreviation, Amount, Units) %>%
  mutate(Year = 2010, Amount = coalesce(Amount, 0)) %>%
  rename(Lake = Lake.Name)

write.csv(fattyacids_2010_processed, "~/FinalProject/NarleskiThompson_ENV872_EDA_FinalProject/ProcessedData/2010_FattyAcids_Processed.csv")

fattyacids_2015_processed <- fattyacids_2015_raw %>%
   select(State, Lake, Species.ID, Scientific.Name, Common.Name, Family, Niche,
         Analyte, Amount, Unit.1, Unit.2) %>%
  mutate(Year = 2015, Amount = coalesce(Amount, 0))

write.csv(fattyacids_2015_processed, "~/FinalProject/NarleskiThompson_ENV872_EDA_FinalProject/ProcessedData/2015_FattyAcids_Processed.csv")

fattyacids_2020_processed <- fattyacids_2020_raw %>%
   select(State, Lake, Species.ID, Scientific.Name, Common.Name, Family, Niche,
         Analyte, Amount, Units) %>%
  mutate(Year = 2020, Amount = coalesce(Amount, 0))

write.csv(fattyacids_2020_processed, "~/FinalProject/NarleskiThompson_ENV872_EDA_FinalProject/ProcessedData/2020_FattyAcids_Processed.csv")

```

\newpage

# Exploratory Analysis
Before beginning analysis aimed at answering our research questions, we explore it in several ways. First, to orient ourselves spatially, we map the all of the sites sampled in 2020. We aren't able use specific site location in our analysis, due to a lack of spatial data in the 2010 and 2015 datasets. However, it is noted in the metadata (from which we extract the sites and their coordinates) that many of the 2020 sites were locations revisited from previous sample years (Figure \@ref(fig:site-map)).[4] Note that the spacing between each sample site and their distance from the shore is an intentional part of the design that ensures the nearshore area of each lake is properly and randomly sampled.
<br>

```{r site-map, echo=FALSE, fig.align='center', fig.cap='Map of nearshore sampling sites used for NCCA 2020', warning=FALSE, message=FALSE}
#site map
sampling_sites <- read_csv("RawData/2020sitelocationsv6.csv")
sampling_sites_clean <- sampling_sites %>% select('Lake','State','SITEID', 'Latitude', 'Longitude')
sampling_sites_clean$Latitude <- as.numeric(sampling_sites_clean$Latitude)
sampling_sites_clean$Longitude<- as.numeric(sampling_sites_clean$Longitude)

sampling_sites_sf <- st_as_sf(
  sampling_sites_clean,
  coords = c("Longitude", "Latitude"), 
  crs = 4326)

states_sf <- st_read(here('RawData/cb_2018_us_county_20m.shp'), quiet=TRUE) %>%
  filter(STATEFP %in% c("26", "36", "39", "42", "55", "27"))

map <- ggplot() +
  geom_sf(data = states_sf, fill = "lightgray", color = "gray") + #counties
  geom_sf(data = sampling_sites_sf, color = "blue", size = 1, alpha = 0.5) + # Plot sites
  labs(title = "Sampling Sites for 2020 NCCA Fish Tissue Contamination Survey", x = "Longitude", y = "Latitude") 

print(map)

#Insert exploratory visualizations of your dataset. This may include, but is not limited to, graphs illustrating the distributions of variables of interest and/or maps of the spatial context of your dataset. Format your R chunks so that graphs are displayed but code is not displayed. Accompany these graphs with text sections that describe the visualizations and provide context for further analyses.

#Each figure should be accompanied by a caption, and each figure should be referenced within the text.

#Scope: think about what information someone might want to know about the dataset before analyzing it statistically. How might you visualize this information?
```
<br>
To better inform our statistical methods for answering our research questions, we explored the presence of each contaminant each year based on (1) lake, (2) fish, and (3) niche. Through the act of processing data for exploration, we discovered some gaps and inconsistencies in data recording that rendered us unable to explore certain aspects of each contaminant. Further, we found inconsistencies in the naming of fish (particularly in capitalization) that required secondary wrangling. 
<br>

## Mercury

Data on mercury is complete across all three time periods. Visualizations of the relationships between mean mercury levels and lake (Huron, Superior, Erie, Michigan, and Ontario), fish species, and niche (Benthic and Pelagic) are below (Figure \@ref(fig:mercury-exp-lake), Figure \@ref(fig:mercury-exp-fish), and Figure \@ref(fig:mercury-exp-niche)).
<br>


```{r mercury exploratory analysis, echo=FALSE, warning=FALSE, message=FALSE}

# Mercury exploratory analysis

# 2010
Mercury_bylake_2010 <- mercury_2010_processed %>%
  group_by(Lake, Year) %>%
  summarise(Mean.Mercury = mean(Amount))

Mercury_byfish_2010 <- mercury_2010_processed %>%
  mutate(Common.Name = str_to_lower(Common.Name)) %>%
  group_by(Scientific.Name, Common.Name, Family, Year) %>%
  summarise(Mean.Mercury = mean(Amount))

Mercury_byniche_2010 <- mercury_2010_processed %>%
  group_by(Niche, Year) %>%
  summarise(Mean.Mercury = mean(Amount))

# 2015
Mercury_bylake_2015 <- mercury_2015_processed %>%
  group_by(Lake, Year) %>%
  summarise(Mean.Mercury = mean(Amount))

Mercury_byfish_2015 <- mercury_2015_processed %>%
  mutate(Common.Name = str_to_lower(Common.Name)) %>%
  group_by(Scientific.Name, Common.Name, Family, Year) %>%
  summarise(Mean.Mercury = mean(Amount))

Mercury_byniche_2015 <- mercury_2015_processed %>%
  group_by(Niche, Year) %>%
  summarise(Mean.Mercury = mean(Amount))

# 2020
Mercury_bylake_2020 <- mercury_2020_processed %>%
  group_by(Lake, Year) %>%
  summarise(Mean.Mercury = mean(Amount))

Mercury_byfish_2020 <- mercury_2020_processed %>%
  mutate(Common.Name = str_to_lower(Common.Name)) %>%
  group_by(Scientific.Name, Common.Name, Family, Year) %>%
  summarise(Mean.Mercury = mean(Amount))

Mercury_byniche_2020 <- mercury_2020_processed %>%
  group_by(Niche, Year) %>%
  summarise(Mean.Mercury = mean(Amount))

# Combined by lake 
Mercury_bylake_combined <- 
  rbind(Mercury_bylake_2010, Mercury_bylake_2015, Mercury_bylake_2020)

# Combined by fish species
Mercury_byfish_combined <-
  rbind(Mercury_byfish_2010, Mercury_byfish_2015, Mercury_byfish_2020) %>%
  mutate(Common.Name = str_to_title(Common.Name))

# Combined by niche
Mercury_byniche_combined <-
  rbind(Mercury_byniche_2010, Mercury_byniche_2015, Mercury_byniche_2020)

```

```{r mercury-exp-lake, echo=FALSE, fig.align='center', fig.cap='Exloratory analysis of mean mercury levels in each of the Great Lakes', warning=FALSE, message=FALSE}
# Creating plot by LAKE
mercury_by_lake <- ggplot(
  Mercury_bylake_combined, aes(
    x = as.factor(Year), y = Mean.Mercury, fill = Lake)) +
  geom_bar(stat = "identity", position = "dodge") +  
  labs(title = "Mercury Levels by Lake (2010-2020)", 
       x = "Year", 
       y = "Mean Mean Mercury (µg/kg)") +
  scale_fill_manual(values = c("Lake Erie" = "lightblue", 
                               "Lake Huron" = "lightgreen", 
                               "Lake Michigan" = "blue", 
                               "Lake Ontario" = "darkgreen", 
                               "Lake Superior" = "darkblue")) 
print(mercury_by_lake)
```

```{r mercury-exp-fish, echo=FALSE, fig.align='center', fig.cap='Exloratory analysis of mean mercury levels in each sampled fish species', warning=FALSE, message=FALSE}

# Creating plot by FISH SPECIES
mercury_by_fish <- ggplot(
  Mercury_byfish_combined, aes(
    x = as.factor(Year), y = Mean.Mercury, fill = Common.Name)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Mean Mercury Levels by Fish (2010-2020)", 
       x = "Year", 
       y = "Mean Mercury (µg/kg)", 
       fill = "Fish Species") 

print(mercury_by_fish)
```

```{r mercury-exp-niche, echo=FALSE, fig.align='center', fig.cap='Exloratory analysis of mean mercury levels by fish niche', warning=FALSE, message=FALSE}

# Creating plot by FISH NICHE
mercury_by_niche <- ggplot(
  Mercury_byniche_combined, aes(
    x = as.factor(Year), y = Mean.Mercury, fill = Niche)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Mean Mercury Levels by Niche (2010-2020)", 
       x = "Year", 
       y = "Mean Mercury (µg/kg)",
       fill = "Niche")

print(mercury_by_niche)
```


<br>

## PCBs

PCBs (Polychlorinated Biphenyls) are also a complete dataset. Visualizations are shown below (Figures \@ref(fig:pcb-exp-lake), \@ref(fig:pcb-exp-fish), \@ref(fig:pcb-exp-niche)). 
<br>

```{r PCB exploratory analysis, echo=FALSE, warning=FALSE, message=FALSE}

# PCB exploratory analysis

# 2010
PCB_bylake_2010 <- PCB_2010_processed %>%
  group_by(Lake, Year) %>%
  summarise(Mean.PCBs = mean(Amount))

PCB_byfish_2010 <- PCB_2010_processed %>%
   mutate(Common.Name = str_to_lower(Common.Name)) %>%
  group_by(Scientific.Name, Common.Name, Family, Year) %>%
  summarise(Mean.PCBs = mean(Amount))

PCB_byniche_2010 <- PCB_2010_processed %>%
  group_by(Niche, Year) %>%
  summarise(Mean.PCBs = mean(Amount))

# 2015
PCB_bylake_2015 <- PCB_2015_processed %>%
  group_by(Lake, Year) %>%
  summarise(Mean.PCBs = mean(Amount))

PCB_byfish_2015 <- PCB_2015_processed %>%
   mutate(Common.Name = str_to_lower(Common.Name)) %>%
  group_by(Scientific.Name, Common.Name, Family, Year) %>%
  summarise(Mean.PCBs = mean(Amount))

PCB_byniche_2015 <- PCB_2015_processed %>%
  group_by(Niche, Year) %>%
  summarise(Mean.PCBs = mean(Amount))

# 2020
PCB_bylake_2020 <- PCB_2020_processed %>%
  group_by(Lake, Year) %>%
  summarise(Mean.PCBs = mean(Amount))

PCB_byfish_2020 <- PCB_2020_processed %>%
   mutate(Common.Name = str_to_lower(Common.Name)) %>%
  group_by(Scientific.Name, Common.Name, Family, Year) %>%
  summarise(Mean.PCBs = mean(Amount))

PCB_byniche_2020 <- PCB_2020_processed %>%
  group_by(Niche, Year) %>%
  summarise(Mean.PCBs = mean(Amount))

# Combined by lake 
PCB_bylake_combined <- 
  rbind(PCB_bylake_2010, PCB_bylake_2015, PCB_bylake_2020)

# Combined by fish species
PCB_byfish_combined <-
  rbind(PCB_byfish_2010, PCB_byfish_2015, PCB_byfish_2020) %>%
  mutate(Common.Name = str_to_title(Common.Name))

# Combined by niche
PCB_byniche_combined <-
  rbind(PCB_byniche_2010, PCB_byniche_2015, PCB_byniche_2020)

```

```{r pcb-exp-lake, echo=FALSE, fig.align='center', fig.cap='Exloratory analysis of mean PCB levels in each of the Great Lakes', warning=FALSE, message=FALSE}
PCB_by_lake <- ggplot(
  PCB_bylake_combined, aes(
    x = as.factor(Year), y = Mean.PCBs, fill = Lake)) +
  geom_bar(stat = "identity", position = "dodge") +  
  labs(title = "PCB Levels by Lake (2010-2020)", 
       x = "Year", 
       y = "Mean PCBs (µg/kg)") +
  scale_fill_manual(values = c("Lake Erie" = "lightblue", 
                               "Lake Huron" = "lightgreen", 
                               "Lake Michigan" = "blue", 
                               "Lake Ontario" = "darkgreen", 
                               "Lake Superior" = "darkblue"))

print(PCB_by_lake)

```

```{r pcb-exp-fish, echo=FALSE, fig.align='center', fig.cap='Exloratory analysis of mean PCB levels in each sampled fish species', warning=FALSE, message=FALSE}

PCB_by_fish <- ggplot(
  PCB_byfish_combined, aes(
    x = as.factor(Year), y = Mean.PCBs, fill = Common.Name)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Mean PCB Levels by Fish (2010-2020)", 
       x = "Year", 
       y = "Mean PCB (µg/kg)", 
       fill = "Fish Species")

print(PCB_by_fish)

```

```{r pcb-exp-niche, echo=FALSE, fig.align='center', fig.cap='Exloratory analysis of mean mercury levels by fish niche', warning=FALSE, message=FALSE}

PCB_by_niche <- ggplot(
  PCB_byniche_combined, aes(
    x = as.factor(Year), y = Mean.PCBs, fill = Niche)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Mean PCB Levels by Niche (2010-2020)", 
       x = "Year", 
       y = "Mean PCB (µg/g)",
       fill = "Niche") 

print(PCB_by_niche)

```
<br>

## Fatty Acids

When exploring the fatty acid data, problems arose with the fact that multiple fatty acids were tested for per sample. Further, most fatty acids are actually beneficial to human health, so to study all of them would be out of our project's scope. Instead, we focus on the subset of fatty acids within the Omega-3 family, as there is clear evidence of negative consequences to human health from consuming fish with excessive Omega-3s [7]. This includes Linoleic acid, Docosahexaenoic acid, Docosapentaenoic acid, Eicosadienoic acid, and Eicosatrienoic acid. In order to make the exploration managable, and also to focus on the direct threat to human health via fish consumption, fatty acids are only grouped by fish species (Figure \@ref(fig:fatty-exp-fish) ), and not lake or niche. 
<br>

```{r fatty-exp-fish, echo=FALSE, fig.align='center', fig.cap='Exloratory analysis of mean fatty acid levels by fish species', warning=FALSE, message=FALSE}

# Sum up fatty acids by fish

# 2010
totalfattyacids_byfish_2010 <- fattyacids_2010_processed %>%
  group_by(Species.ID) %>%
  summarise(Total_Omega3s = sum(Amount),
            Scientific_Name = first(Scientific.Name),
            Common_Name = first(Common.Name),
            Family_Name = first(Family),
            Date = first(Year))

# 2015
totalfattyacids_byfish_2015 <- fattyacids_2015_processed %>%
  # Filter for Omega-3s
  filter(Analyte == "Linoleic acid" | Analyte == 	"Docosahexaenoic acid" |
           Analyte == "Docosapentaenoic acid" | Analyte == "Eicosadienoic acid"
        |  Analyte ==  "Eicosatrienoic acid") %>%
  group_by(Species.ID) %>%
  # Sum up filtered Omega-3s and divide by 1000 to convert from ug/g to mg/g
  summarise(Total_Omega3s = sum(Amount) / 1000,
            Scientific_Name = first(Scientific.Name),
            Common_Name = first(Common.Name),
            Family_Name = first(Family),
            Date = first(Year))

# 2020
totalfattyacids_byfish_2020 <- fattyacids_2020_processed %>%
  # Filter for Omega-3s
   filter(Analyte == "Linoleic acid" | Analyte == 	"Docosahexaenoic acid" |
           Analyte == "Docosapentaenoic acid" | Analyte == "Eicosadienoic acid"
        |  Analyte ==  "Eicosatrienoic acid") %>%
  group_by(Species.ID) %>%
  # Sum up filtered Omega-3s and divide by 1000 to convert from ug/g to mg/g
  summarise(Total_Omega3s = sum(Amount) / 1000,
            Scientific_Name = first(Scientific.Name),
            Common_Name = first(Common.Name),
            Family_Name = first(Family),
            Date = first(Year))

# Combined by fish
FA_byfish_combined <-
  rbind(totalfattyacids_byfish_2010, 
        totalfattyacids_byfish_2015, 
        totalfattyacids_byfish_2020) %>%
    mutate(Common_Name = str_to_title(Common_Name))

## PLOTS
# Creating plot by FISH SPECIES
fattyacid_by_fish <- ggplot(
  FA_byfish_combined, aes(
    x = as.factor(Date), y = Total_Omega3s, fill = Common_Name)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Total Omega-3 & 6 Levels by Fish (2010-2020)", 
       x = "Date", 
       y = "Omega-3 & 6s (m/g)", 
       fill = "Fish Species")

print(fattyacid_by_fish)

```


<br>

## PFAs

Like Fatty Acids, there are multiple PFAs (Per- and Polyfluoroalkyl Substances) that were measured in the sampling. Of the ones included, we filtered out four specifically, due to their known negative effect on human health (Perfluorooctanoate (PFOA), Perfluorooctanesulfonate (PFOS), Perfluorohexane sulfonate (PFHxS),and Perfluorononanoate (PFNA)). They are also specifically monitored by the EPA across other projects, and have clear levels where they become unsafe for consumption [6]. We used mean PFA values for each lake, (Figure \@ref(fig:pfa-exp-lake) ), each fish species (Figure \@ref(fig:pfa-exp-fish) ), and for each niche (Figure \@ref(fig:pfa-exp-niche) ).

```{r pfa-exp, echo=FALSE, warning=FALSE, message=FALSE}

# PFAs Exploratory Analysis

# 2010
totalPFAs_bylake_2010 <- PFA_2010_processed %>%
  filter(Analyte == "Perfluorooctanoate (PFOA)" | 
           Analyte == "Perfluorooctanesulfonate (PFOS)" | 
           Analyte == "Perfluorohexane sulfonate (PFHxS)" |
           Analyte == "Perfluorononanoate (PFNA)") %>%
  group_by(Lake, Analyte, Year) %>%
  summarise(Total.PFAs = sum(Amount))

PFAs_byfish_2010 <- PFA_2010_processed %>%
  filter(Analyte == "Perfluorooctanoate (PFOA)" | 
           Analyte == "Perfluorooctanesulfonate (PFOS)" | 
           Analyte == "Perfluorohexane sulfonate (PFHxS)" |
           Analyte == "Perfluorononanoate (PFNA)") %>%
   mutate(Common.Name = str_to_lower(Common.Name)) %>%
  group_by(Common.Name, Analyte, Year) %>%
  summarise(Mean.PFAs = mean(Amount))

PFAs_byniche_2010 <- PFA_2010_processed %>%
  filter(Analyte == "Perfluorooctanoate (PFOA)" | 
           Analyte == "Perfluorooctanesulfonate (PFOS)" | 
           Analyte == "Perfluorohexane sulfonate (PFHxS)" |
           Analyte == "Perfluorononanoate (PFNA)") %>%
  group_by(Niche, Analyte, Year) %>%
  summarise(Mean.PFAs = mean(Amount))

# 2015
totalPFAs_bylake_2015 <- PFA_2015_processed %>%
  filter(Analyte == "Perfluorooctanoate (PFOA)" | 
           Analyte == "Perfluorooctanesulfonate (PFOS)" | 
           Analyte == "Perfluorohexane sulfonate (PFHxS)" |
           Analyte == "Perfluorononanoate (PFNA)") %>%
  group_by(Lake, Analyte, Year) %>%
  summarise(Total.PFAs = sum(Amount))

PFAs_byfish_2015 <- PFA_2015_processed %>%
  filter(Analyte == "Perfluorooctanoate (PFOA)" | 
           Analyte == "Perfluorooctanesulfonate (PFOS)" | 
           Analyte == "Perfluorohexane sulfonate (PFHxS)" |
           Analyte == "Perfluorononanoate (PFNA)") %>%
   mutate(Common.Name = str_to_lower(Common.Name)) %>%
  group_by(Common.Name, Analyte, Year) %>%
  summarise(Mean.PFAs = mean(Amount))

PFAs_byniche_2015 <- PFA_2015_processed %>%
  filter(Analyte == "Perfluorooctanoate (PFOA)" | 
           Analyte == "Perfluorooctanesulfonate (PFOS)" | 
           Analyte == "Perfluorohexane sulfonate (PFHxS)" |
           Analyte == "Perfluorononanoate (PFNA)") %>%
  group_by(Niche, Analyte, Year) %>%
  summarise(Mean.PFAs = mean(Amount))


# 2020
totalPFAs_bylake_2020 <- PFA_2020_processed %>%
  filter(Analyte == "PFOA" | Analyte == "PFOS" | Analyte == "PFHxS" |
          Analyte == "PFNA" | Analyte == "HFPO-DA") %>%
  group_by(Lake, Analyte, Year) %>%
  summarise(Total.PFAs = sum(Amount))

PFAs_byfish_2020 <- PFA_2020_processed %>%
  filter(Analyte == "PFOA" | Analyte == "PFOS" | Analyte == "PFHxS" |
          Analyte == "PFNA"| Analyte == "HFPO-DA") %>%
   mutate(Common.Name = str_to_lower(Common.Name)) %>%
  group_by(Common.Name, Analyte, Year) %>%
  summarise(Mean.PFAs = mean(Amount))

PFAs_byniche_2020 <- PFA_2020_processed %>%
  filter(Analyte == "PFOA" | Analyte == "PFOS" | Analyte == "PFHxS" |
          Analyte == "PFNA"| Analyte == "HFPO-DA") %>%
  group_by(Niche, Analyte, Year) %>%
  summarise(Mean.PFAs = mean(Amount))



```

```{r pfa-exp-lake, echo=FALSE, fig.align='center', fig.cap='Exloratory analysis of total PFA levels by lake', warning=FALSE, message=FALSE}

#combined by lake 
PFA_bylake_combined <- 
  rbind(totalPFAs_bylake_2010,
        totalPFAs_bylake_2015,
        totalPFAs_bylake_2020)

# mean values for each lake 
PFA_bylake_2010_mean_values <- totalPFAs_bylake_2010 %>%
  group_by(Lake, Year) %>%
  summarise(mean_PFAs = mean(Total.PFAs))

PFA_bylake_2015_mean_values <- totalPFAs_bylake_2015 %>%
  group_by(Lake, Year) %>%
  summarise(mean_PFAs = mean(Total.PFAs))

PFA_bylake_2020_mean_values <- totalPFAs_bylake_2020 %>%
  group_by(Lake, Year) %>%
  summarise(mean_PFAs = mean(Total.PFAs))

#means combined by lake 
PFA_bylake_combined_meanvalues <- 
  rbind(PFA_bylake_2010_mean_values,
        PFA_bylake_2015_mean_values,
        PFA_bylake_2020_mean_values)

PFA_by_lake <- ggplot(
 PFA_bylake_combined_meanvalues , aes(
    x = as.factor(Year), y = mean_PFAs, fill = Lake)) +
  geom_bar(stat = "identity", position = "dodge") +  
  labs(title = "PFA Levels by Lake (2010-2020)", 
       x = "Year", 
       y = "Total PFAs (µg/kg)") +
  scale_fill_manual(values = c("Lake Erie" = "lightblue", 
                               "Lake Huron" = "lightgreen", 
                               "Lake Michigan" = "blue", 
                               "Lake Ontario" = "darkgreen", 
                               "Lake Superior" = "darkblue"))


print(PFA_by_lake)


```

```{r pfa-exp-fish, echo=FALSE, fig.align='center', fig.cap='Exloratory analysis of mean PFA levels by fish species', warning=FALSE, message=FALSE}
# Combined by fish species
PFA_byfish_combined <-
  rbind(PFAs_byfish_2010, PFAs_byfish_2015, PFAs_byfish_2020) %>%
  mutate(Common.Name = str_to_title(Common.Name))

PFA_by_fish <- ggplot(
  PFA_byfish_combined, aes(
    x = as.factor(Year), y = Mean.PFAs, fill = Common.Name)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Mean PFA Levels by Fish (2010-2020)", 
       x = "Year", 
       y = "Mean PFA (µg/kg)", 
       fill = "Fish Species")

print(PFA_by_fish) 

```

```{r pfa-exp-niche, echo=FALSE, fig.align='center', fig.cap='Exloratory analysis of mean PFA levels by fish niche', warning=FALSE, message=FALSE}
# Combined by niche
PFA_byniche_combined <-
  rbind(PFAs_byniche_2010, PFAs_byniche_2015, PFAs_byniche_2020)

PFA_by_niche <- ggplot(
  PFA_byniche_combined, aes(
    x = as.factor(Year), y = Mean.PFAs, fill = Niche)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Mean PFA Levels by Niche (2010-2020)", 
       x = "Year", 
       y = "Mean PFA (µg/g)",
       fill = "Niche") 

print(PFA_by_niche)

```

\newpage

# Analysis

## Question 1: Does average fish tissue contamination vary significantly between each lake within each sampling year?
<br>
For this question, we use an **ANOVA** (Analysis of Variance) to compare the means contaminants of fish sourced from each lake to determine if there are statistical differences between them. We test the **null hypothesis that there is no effect of lake on contaminant levels** (i.e. there is not a statistically significant difference between them). Since we are focusing on one categorical independent variable (the lakes), we employ a one-way ANOVA. We perform twelve ANOVAs, one for each of the contaminants (3) and one for each year (3). The results of the 9 ANOVAs are recorded in Table \@ref(tab:contaminant-anova-table) below. The degrees of freedom for each ANOVA is 4.
<br>
<p style="color: darkgray;">*Note: Because of the complex and incomplete Fatty Acid data, as well as its mixed effect on human health, we exclude Fatty Acids from this analysis*.</p>

```{r contaminant-anova-table, echo=FALSE, message=FALSE}
contaminant_anova <- data.frame(
  Contaminant = c(
    "Mercury", "Mercury", "Mercury", 
    "PCB", "PCB", "PCB", 
    "PFA", "PFA", "PFA"
  ),
  Year = c(2010, 2015, 2020, 2010, 2015, 2020, 2010, 2015, 2020),
  `F Value` = c(6.397, 3.357, 2.127, 3.067, 16.48, 6.599, 5.987, 4.807, 7.257),
  `P-value` = c(8.74e-05, 0.0116, 0.0798, 0.0183, 3.56e-11, 6.11e-05, 8.68e-05, 0.000736, 7.93e-06),
  `Significant? (p < 0.05)` = c(
    "<span style='color:green'>YES</span>", "<span style='color:green'>YES</span>", 
    "<span style='color:red'>NO</span>", "<span style='color:green'>YES</span>", 
    "<span style='color:green'>YES</span>", "<span style='color:green'>YES</span>", 
    "<span style='color:green'>YES</span>", "<span style='color:green'>YES</span>", 
    "<span style='color:green'>YES</span>"
  )
)

names(contaminant_anova) <- c("Contaminant", "Year", "F Value", "P-value", "Significant? (p<0.05)")

kable(
  contaminant_anova, 
  caption = "ANOVA results of mean contaminant levels found in fish samples from each of the Great Lakes from 3 sampling years.", 
  escape = FALSE
)
```

The results of the ANOVAs indicate that for all contaminants except Mercury in 2020, the mean contaminant level between lakes varied significantly (p<0.05). This suggests that the levels of contaminants are not evenly distributed across the Great Lakes, potentially due to differences in environmental conditions, pollutant sources, or other ecological factors. The lack of significant variation in Mercury levels in 2020 may indicate more consistent exposure across lakes for this contaminant during that year. 
<br>
```{r anovas, echo=FALSE, warning=FALSE, message=FALSE, include = FALSE}

#Mercury 2010
mercury_2010_processed$Lake <- as.factor(mercury_2010_processed$Lake)
mercury_bylake_2010_AOV <- aov(Amount ~ Lake, data = mercury_2010_processed)
summary(mercury_bylake_2010_AOV)
  #p = 8.74e-05 (SIG)

#Mercury 2015
mercury_2015_processed$Lake <- as.factor(mercury_2015_processed$Lake)
mercury_bylake_2015_AOV <- aov(Amount ~ Lake, data = mercury_2015_processed)
summary(mercury_bylake_2015_AOV)
  #p = .0116 (SIG)

#Mercury 2020
mercury_2020_processed$Lake <- as.factor(mercury_2020_processed$Lake)
mercury_bylake_2020_AOV <- aov(Amount ~ Lake, data = mercury_2020_processed)
summary(mercury_bylake_2020_AOV)
  #p = .00798 (NOTSIG)

#PCB 2010
PCB_2010_processed$Lake <- as.factor(PCB_2010_processed$Lake)
PCB_bylake_2010_AOV <- aov(Amount ~ Lake, data = PCB_2010_processed)
summary(PCB_bylake_2010_AOV)
  #p = 0.0183 (SIG)

#PCB 2015
PCB_2015_processed$Lake <- as.factor(PCB_2015_processed$Lake)
PCB_bylake_2015_AOV <- aov(Amount ~ Lake, data = PCB_2015_processed)
summary(PCB_bylake_2015_AOV)
  #p = 3.56e-11 (SIG)

#PCB 2020
PCB_2020_processed$Lake <- as.factor(PCB_2020_processed$Lake)
PCB_bylake_2020_AOV <- aov(Amount ~ Lake, data = PCB_2020_processed)
summary(PCB_bylake_2020_AOV)
  #p = 6.11e-05 (SIG)

#PFA 2010
PFA_2010_processed$Lake <- as.factor(PFA_2010_processed$Lake )
PFA_bylake_2010_AOV <- aov(Amount ~ Lake, data = PFA_2010_processed)
summary(PFA_bylake_2010_AOV)
  #p = 8.68e-05 (SIG)

#PFA 2015
PFA_2015_processed$Lake <- as.factor(PFA_2015_processed$Lake )
PFA_bylake_2015_AOV <- aov(Amount ~ Lake, data = PFA_2015_processed)
summary(PFA_bylake_2015_AOV)
  #p = 0.000736 (SIG)

#PFA 2020
PFA_2020_processed$Lake <- as.factor(PFA_2020_processed$Lake )
PFA_bylake_2020_AOV <- aov(Amount ~ Lake, data = PFA_2020_processed)
summary(PFA_bylake_2020_AOV)
  #p = 0.000736 (SIG)


```
We continue this analysis by performing a Tukey's HSD test in order to investigate which lakes specifically differ from each other within each ANOVA. We assess only ANOVAs that were significant (ie. excluding Mercury 2020). Further, to maintain a reasonable analysis size, and because it is the most recent year with statistically different means for all three contaminants, we perform a Tukey test only on the 2015 ANOVAs. 
<br>
The results from the 2015 Mercury Tukey test reveal that Lake Erie, Huron, and Michigan are not statistically different, while Lake Ontario and Superior are statistically different from them and from each other (Figure \@ref(fig:mercury-tukey-plot) ). Similarly, for the 2015 PCBs, Lake Erie, Huron, and Michigan are not statistically different (Figure \@ref(fig:PCB-tukey-plot) ). However, Lake Ontario is statistically different from all other lakes, but Lake Superior is only different from Lake Ontario and Erie. Lastly, for PFAs, Lake Erie, Huron, Michigan, and Ontario were not statistically different; Lake Superior was not statistically different from Lake Huron or Lake Michigan (Figure \@ref(fig:PFA-tukey-plot) ). 
<br> 
<br> 
From this analysis, it is apparent that Lakes Erie, Huron, and Michigan tend to have contaminant means that are not statistically different from each other, while Lakes Ontario and Superior more often had significantly different means from them.


```{r tukey, echo=FALSE, warning=FALSE, message=FALSE, include = FALSE}
mercury_bylake_2015_AOV.groups <- HSD.test(mercury_bylake_2015_AOV, "Lake", group = TRUE)
mercury_bylake_2015_AOV.groups$groups

PCB_bylake_2015_AOV.groups <- HSD.test(PCB_bylake_2015_AOV, "Lake", group = TRUE)
PCB_bylake_2015_AOV.groups$groups

PFA_bylake_2015_AOV.groups <- HSD.test(PFA_bylake_2015_AOV, "Lake", group = TRUE)
PFA_bylake_2015_AOV.groups$groups


```
```{r mercury-tukey-plot, fig.align='center', fig.cap='Results of Tukey HSD test performed on ANOVA of Mercury levels in sampled fish from each of the Great Lakes.', warning=FALSE, message=FALSE, echo = FALSE}

mercury.tukey.plot <- ggplot(Mercury_bylake_2015, aes(x = Lake, y = Mean.Mercury, fill = Lake)) +
  geom_bar(stat = "identity") +  
  geom_text(aes(label = c("ab", "ab", "ab", "a", "b")), vjust = -0.5, size = 4) +  
  labs(x = "Lake", y = "Mean Mercury (ug/g)") + 
  scale_fill_manual(values = c("Lake Erie" = "lightblue", 
                               "Lake Huron" = "lightgreen", 
                               "Lake Michigan" = "blue", 
                               "Lake Ontario" = "darkgreen", 
                               "Lake Superior" = "darkblue")) + laketheme

print(mercury.tukey.plot)


```

```{r PCB-tukey-plot, fig.align='center', fig.cap='Results of Tukey HSD test performed on ANOVA of PCB levels in sampled fish from each of the Great Lakes.', warning=FALSE, message=FALSE, echo=FALSE}

PCB.tukey.plot <- ggplot(PCB_bylake_2015, aes(x = Lake, y = Mean.PCBs, fill = Lake)) +
  geom_bar(stat = "identity") +  
  geom_text(aes(label = c("b", "bc", "bc", "a", "c")), vjust = -0.5, size = 4) +  
  labs(x = "Lake", y = "Mean PFAs (ug/g)") + 
  scale_fill_manual(values = c("Lake Erie" = "lightblue", 
                               "Lake Huron" = "lightgreen", 
                               "Lake Michigan" = "blue", 
                               "Lake Ontario" = "darkgreen", 
                               "Lake Superior" = "darkblue")) + laketheme

print(PCB.tukey.plot)
```

```{r PFA-tukey-plot, fig.align='center', fig.cap='Results of Tukey HSD test performed on ANOVA of PFA levels in sampled fish from each of the Great Lakes.', warning=FALSE, message=FALSE, echo = FALSE}

PFA.tukey.plot <- ggplot(PFA_bylake_2015_mean_values, aes(x = Lake, y = mean_PFAs, fill = Lake)) +
  geom_bar(stat = "identity") +  
  geom_text(aes(label = c("a", "ab", "ab", "a", "b")), vjust = -0.5, size = 4) +  
  labs(x = "Lake", y = "Mean PFAs (ug/g)") + 
  scale_fill_manual(values = c("Lake Erie" = "lightblue", 
                               "Lake Huron" = "lightgreen", 
                               "Lake Michigan" = "blue", 
                               "Lake Ontario" = "darkgreen", 
                               "Lake Superior" = "darkblue")) + laketheme

print(PFA.tukey.plot)
```

## Question 2: Are there trends in contaminant levels in each fish species over time?
<br>
To investigate the presence of potential  trends in each over time, we use **linear regressions**. Unfortunately, with only three sample years, there is not sufficient data for a time series. Instead, we search for meaningful results of linear regression models. **We focus only on fish species for which there is data for all three sample years.** We determined which fish had data for all three years using the results from our exploratory anaylses. 14 fish species qualified for this analysis (Brown Trout, Channel Catfish, Chinook Salmon, Coho Salmon, Freshwater Drum, Lake Trout, Lake Whitefish, Longnose Sucker, Rainbow Trout, Smallmouth Bass, Walleye, White Perch, White Sucker, and Yellow Perch). We run 3 models, one for each contaminant (again excluding Fatty Acids for the aforementioned reasons), inputting "contaminant amount" as the dependent variable, "Year" as the dependent variable, and "Fish Species" as the grouping variable into the regression.
<br>
For mercury, 14 fish species were repeatedly sampled in each of the study years. The mean mercury values for each species were plotted over time, with a line of best fit for each species (Figure \@ref(fig:mercury-fish-trend-plot)). Linear regressions were conducted for each species to assess whether mercury levels changed significantly over the years. However, **none** of the regressions indicated a significant relationship between year and mercury level (all p > 0.05), suggesting no statistically significant trends in mercury levels for these species over time.

```{r mercury-fish-trend-plot, fig.align='center', fig.cap='Mean mercury levels over time of each fish species sampled in the Great Lakes', warning=FALSE, message=FALSE, echo=FALSE, warning=FALSE, message=FALSE}
#mercury 
Mercury_byfish_combined_threeyeardata <- Mercury_byfish_combined %>% filter(Common.Name %in% c("Brown Trout", "Channel Catfish","Chinook Salmon","Coho Salmon","Freshwater Drum","Lake Trout","Lake Whitefish","Longnose Sucker", "Rainbow Trout", "Smallmouth Bass", "Walleye","White Perch","White Sucker","Yellow Perch")) #only fish with mercury data for all three years

mercury_by_fish_plot <- ggplot(Mercury_byfish_combined_threeyeardata, aes(x = as.factor(Year), y = Mean.Mercury, color = Common.Name)) +
  geom_point() +
  geom_smooth(method = "lm", aes(group = Common.Name), se = FALSE) +
  labs(title = "Mean Mercury Levels by Fish Species (2010-2020)", x = "Year", y = "Mean Mercury (µg/kg)") 
print(mercury_by_fish_plot)
```
```{r mercury-fish-regressions, echo=FALSE, warning=FALSE, message=FALSE, include = FALSE}

#separating the fish species

# Brown Trout
brown_trout_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "Brown Trout")
brown_trout_lm <- lm(Mean.Mercury ~ Year, data = brown_trout_data)
summary(brown_trout_lm)
#nonsig

# Channel Catfish
channel_catfish_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "Channel Catfish")
channel_catfish_lm <- lm(Mean.Mercury ~ Year, data = channel_catfish_data)
summary(channel_catfish_lm)
#nonsig

# Chinook Salmon
chinook_salmon_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "Chinook Salmon")
chinook_salmon_lm <- lm(Mean.Mercury ~ Year, data = chinook_salmon_data)
summary(chinook_salmon_lm)
#nonsig

# Coho Salmon
coho_salmon_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "Coho Salmon")
coho_salmon_lm <- lm(Mean.Mercury ~ Year, data = coho_salmon_data)
summary(coho_salmon_lm)
#nonsig

# Freshwater Drum
freshwater_drum_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "Freshwater Drum")
freshwater_drum_lm <- lm(Mean.Mercury ~ Year, data = freshwater_drum_data)
summary(freshwater_drum_lm)
#nonsig

# Lake Trout
lake_trout_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "Lake Trout")
lake_trout_lm <- lm(Mean.Mercury ~ Year, data = lake_trout_data)
summary(lake_trout_lm)
#nonsig

# Lake Whitefish
lake_whitefish_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "Lake Whitefish")
lake_whitefish_lm <- lm(Mean.Mercury ~ Year, data = lake_whitefish_data)
summary(lake_whitefish_lm)
#nonsig

# Longnose Sucker
longnose_sucker_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "Longnose Sucker")
longnose_sucker_lm <- lm(Mean.Mercury ~ Year, data = longnose_sucker_data)
summary(longnose_sucker_lm)
#nonsig

# Rainbow Trout
rainbow_trout_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "Rainbow Trout")
rainbow_trout_lm <- lm(Mean.Mercury ~ Year, data = rainbow_trout_data)
summary(rainbow_trout_lm)
#nonsig

# Smallmouth Bass
smallmouth_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "Smallmouth Bass")
smallmouth_lm <- lm(Mean.Mercury ~ Year, data = smallmouth_data)
summary(smallmouth_lm)
#nonsig

# Walleye
walleye_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "Walleye")
walleye_lm <- lm(Mean.Mercury ~ Year, data = walleye_data)
summary(walleye_lm)
#nonsig

# White Perch
white_perch_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "White Perch")
white_perch_lm <- lm(Mean.Mercury ~ Year, data = white_perch_data)
summary(white_perch_lm)
#nonsig

# White Sucker
white_sucker_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "White Sucker")
white_sucker_lm <- lm(Mean.Mercury ~ Year, data = white_sucker_data)
summary(white_sucker_lm)
#nonsig

# Yellow Perch
yellow_perch_data <- subset(Mercury_byfish_combined_threeyeardata, Common.Name == "Yellow Perch")
yellow_perch_lm <- lm(Mean.Mercury ~ Year, data = yellow_perch_data)
summary(yellow_perch_lm)
#nonsig

```
<br> 
This process is repeated for PCBs. The same 14 fish as mercury had data available for all three years (Figure \@ref(fig:PCB-fish-trend-plot)). Of all 14 fish, only one presented a p-value indicating a sigificant relationship between PCB level and year for that species. White Perch had a p-value of 0.04507 (p<0.5) and an adjusted R-squared value of 0.99.  
<br>
```{r PCB-fish-trend-plot, fig.align='center', fig.cap='Mean mercury levels over time of each fish species sampled in the Great Lakes', warning=FALSE, message=FALSE, echo=FALSE, warning=FALSE, message=FALSE}
#PCB
PCB_byfish_combined_threeyeardata <- PCB_byfish_combined %>% filter(Common.Name %in% c("Brown Trout", "Channel Catfish","Chinook Salmon","Coho Salmon","Freshwater Drum","Lake Trout","Lake Whitefish","Longnose Sucker", "Rainbow Trout", "Smallmouth Bass", "Walleye","White Perch","White Sucker","Yellow Perch")) #only fish with PCB data for all three years

PCB_by_fish_plot <- ggplot(PCB_byfish_combined_threeyeardata, aes(x = as.factor(Year), y = Mean.PCBs, color = Common.Name)) +
  geom_point() +
  geom_smooth(method = "lm", aes(group = Common.Name), se = FALSE) +
  labs(title = "Mean PCB Levels by Fish Species (2010-2020)", x = "Year", y = "Mean PCBs (µg/kg)") 
print(PCB_by_fish_plot)
```

```{r PCB-fish-regressions, echo=FALSE, warning=FALSE, message=FALSE, include = FALSE}
# Brown Trout (PCB)
brown_trout_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "Brown Trout")
brown_trout_PCB_lm <- lm(Mean.PCBs ~ Year, data = brown_trout_PCB_data)
summary(brown_trout_PCB_lm)
#nonsig

# Channel Catfish (PCB)
channel_catfish_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "Channel Catfish")
channel_catfish_PCB_lm <- lm(Mean.PCBs ~ Year, data = channel_catfish_PCB_data)
summary(channel_catfish_PCB_lm)
#nonsig

# Chinook Salmon (PCB)
chinook_salmon_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "Chinook Salmon")
chinook_salmon_PCB_lm <- lm(Mean.PCBs ~ Year, data = chinook_salmon_PCB_data)
summary(chinook_salmon_PCB_lm)

# Coho Salmon (PCB)
coho_salmon_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "Coho Salmon")
coho_salmon_PCB_lm <- lm(Mean.PCBs ~ Year, data = coho_salmon_PCB_data)
summary(coho_salmon_PCB_lm)

# Freshwater Drum (PCB)
freshwater_drum_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "Freshwater Drum")
freshwater_drum_PCB_lm <- lm(Mean.PCBs ~ Year, data = freshwater_drum_PCB_data)
summary(freshwater_drum_PCB_lm)

# Lake Trout (PCB)
lake_trout_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "Lake Trout")
lake_trout_PCB_lm <- lm(Mean.PCBs ~ Year, data = lake_trout_PCB_data)
summary(lake_trout_PCB_lm)

# Lake Whitefish (PCB)
lake_whitefish_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "Lake Whitefish")
lake_whitefish_PCB_lm <- lm(Mean.PCBs ~ Year, data = lake_whitefish_PCB_data)
summary(lake_whitefish_PCB_lm)

# Longnose Sucker (PCB)
longnose_sucker_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "Longnose Sucker")
longnose_sucker_PCB_lm <- lm(Mean.PCBs ~ Year, data = longnose_sucker_PCB_data)
summary(longnose_sucker_PCB_lm)

# Rainbow Trout (PCB)
rainbow_trout_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "Rainbow Trout")
rainbow_trout_PCB_lm <- lm(Mean.PCBs ~ Year, data = rainbow_trout_PCB_data)
summary(rainbow_trout_PCB_lm)

# Smallmouth Bass (PCB)
smallmouth_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "Smallmouth Bass")
smallmouth_PCB_lm <- lm(Mean.PCBs ~ Year, data = smallmouth_PCB_data)
summary(smallmouth_PCB_lm)

# Walleye (PCB)
walleye_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "Walleye")
walleye_PCB_lm <- lm(Mean.PCBs ~ Year, data = walleye_PCB_data)
summary(walleye_PCB_lm)

# White Perch (PCB)
white_perch_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "White Perch")
white_perch_PCB_lm <- lm(Mean.PCBs ~ Year, data = white_perch_PCB_data)
summary(white_perch_PCB_lm)
#SIGNIFICANT

# White Sucker (PCB)
white_sucker_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "White Sucker")
white_sucker_PCB_lm <- lm(Mean.PCBs ~ Year, data = white_sucker_PCB_data)
summary(white_sucker_PCB_lm)

# Yellow Perch (PCB)
yellow_perch_PCB_data <- subset(PCB_byfish_combined_threeyeardata, Common.Name == "Yellow Perch")
yellow_perch_PCB_lm <- lm(Mean.PCBs ~ Year, data = yellow_perch_PCB_data)
summary(yellow_perch_PCB_lm)
```

Finally, a plot is created for PFAs (Figure \@ref(fig:PFA-fish-trend-plot)). Since PFAs are divided into 6 separate compounds of interest, the mean was taken of each of these 6 compounds for each fish. In the future, a more detailed analysis by each PFA should be performed. Using mean PFA levels, both the Brown Trout (p=4.888e-05) and Walleye (p=0.02977) have a significant p value (p<0.05), indicating a relationship between Year and Mean PFA level for the species.

```{r PFA-fish-trend-plot, fig.align='center', fig.cap='Mean PFA levels over time of each fish species sampled in the Great Lakes', warning=FALSE, message=FALSE, echo=FALSE, warning=FALSE, message=FALSE}
#PFA

# mean values for each fish of each PFA combined
PFA_byfish_2010_mean_values <- PFAs_byfish_2010 %>%
  group_by(Common.Name, Year) %>%
  summarise(mean_PFAs = mean(Mean.PFAs))

PFA_byfish_2015_mean_values <- PFAs_byfish_2015 %>%
  group_by(Common.Name, Year) %>%
  summarise(mean_PFAs = mean(Mean.PFAs))

PFA_byfish_2020_mean_values <- PFAs_byfish_2020 %>%
  group_by(Common.Name, Year) %>%
  summarise(mean_PFAs = mean(Mean.PFAs))

PFA_by_fish_mean_values_combined <-
  rbind(PFA_byfish_2010_mean_values,PFA_byfish_2015_mean_values,PFA_byfish_2020_mean_values)

PFA_byfish_combined_threeyeardata <- PFA_by_fish_mean_values_combined %>% filter(Common.Name %in% c("brown trout", "channel catfish","chinook salmon","coho salmon","freshwater drum","lake trout","lake whitefish","longnose sucker", "rainbow trout", "smallmouth bass", "walleye","white perch","white sucker","yellow perch")) #only fish with PFA data for all three years

PFA_by_fish_plot <- ggplot(PFA_byfish_combined_threeyeardata, aes(x = as.factor(Year), y = mean_PFAs, color = Common.Name)) +
  geom_point() +
  geom_smooth(method = "lm", aes(group = Common.Name), se = FALSE) +
  labs(title = "Mean PFA Levels by Fish Species (2010-2020)", x = "Year", y = "Mean PFAs (µg/kg)") 
print(PFA_by_fish_plot)

```

```{r PFA-fish-regressions, echo=FALSE, warning=FALSE, message=FALSE, include = FALSE}
brown_trout_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "brown trout")
brown_trout_PFA_lm <- lm(mean_PFAs ~ Year, data = brown_trout_PFA_data)
summary(brown_trout_PFA_lm)
#SIG p: 4.888e-05

# channel catfish 
channel_catfish_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "channel catfish")
channel_catfish_PFA_lm <- lm(mean_PFAs ~ Year, data = channel_catfish_PFA_data)
summary(channel_catfish_PFA_lm)

# chinook salmon 
chinook_salmon_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "chinook salmon")
chinook_salmon_PFA_lm <- lm(mean_PFAs ~ Year, data = chinook_salmon_PFA_data)
summary(chinook_salmon_PFA_lm)

# coho salmon 
coho_salmon_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "coho salmon")
coho_salmon_PFA_lm <- lm(mean_PFAs ~ Year, data = coho_salmon_PFA_data)
summary(coho_salmon_PFA_lm)

# freshwater drum 
freshwater_drum_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "freshwater drum")
freshwater_drum_PFA_lm <- lm(mean_PFAs ~ Year, data = freshwater_drum_PFA_data)
summary(freshwater_drum_PFA_lm)

# lake trout 
lake_trout_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "lake trout")
lake_trout_PFA_lm <- lm(mean_PFAs ~ Year, data = lake_trout_PFA_data)
summary(lake_trout_PFA_lm)

# lake whitefish 
lake_whitefish_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "lake whitefish")
lake_whitefish_PFA_lm <- lm(mean_PFAs ~ Year, data = lake_whitefish_PFA_data)
summary(lake_whitefish_PFA_lm)

# longnose sucker 
longnose_sucker_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "longnose sucker")
longnose_sucker_PFA_lm <- lm(mean_PFAs ~ Year, data = longnose_sucker_PFA_data)
summary(longnose_sucker_PFA_lm)

# rainbow trout 
rainbow_trout_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "rainbow trout")
rainbow_trout_PFA_lm <- lm(mean_PFAs ~ Year, data = rainbow_trout_PFA_data)
summary(rainbow_trout_PFA_lm)

# smallmouth bass 
smallmouth_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "smallmouth bass")
smallmouth_PFA_lm <- lm(mean_PFAs ~ Year, data = smallmouth_PFA_data)
summary(smallmouth_PFA_lm)

# walleye 
walleye_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "walleye")
walleye_PFA_lm <- lm(mean_PFAs ~ Year, data = walleye_PFA_data)
summary(walleye_PFA_lm)
#SIG p-value: 0.02977

# white perch 
white_perch_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "white perch")
white_perch_PFA_lm <- lm(mean_PFAs ~ Year, data = white_perch_PFA_data)
summary(white_perch_PFA_lm)

# white sucker 
white_sucker_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "white sucker")
white_sucker_PFA_lm <- lm(mean_PFAs ~ Year, data = white_sucker_PFA_data)
summary(white_sucker_PFA_lm)

# yellow perch 
yellow_perch_PFA_data <- subset(PFA_byfish_combined_threeyeardata, Common.Name == "yellow perch")
yellow_perch_PFA_lm <- lm(mean_PFAs ~ Year, data = yellow_perch_PFA_data)
summary(yellow_perch_PFA_lm)
```

From these regressions, we can conclude that there are no species for which year and Mercury level have a significant relationship; there is a significant relationship between year and PCB level only for White Perch; and there is a significant relationship between year and PFA level for Brown Trout and Walleye.


## Question 3: Are different species significantly more vulnerable than others to different contaminants? *I THINK WE SHOULD CHANGE OR DELETE THIS QUESTION*




\newpage

# Summary and Conclusions
variance between lakes means you probably cant just use braod and comprehensive management plans

mercury level the samne between fish means there may not be biological differences that can protect certain fish form mercury bioaccumulation (non discriminatory contamination)

require more data points for more confident anaylsis- motivation to continue NCCA

\newpage

# References - i have to make these APA still but just links for now
[1]The Great Lakes. (n.d.). National Wildlife Federation. Retrieved December 8, 2024, from https://www.nwf.org/Home/Educational-Resources/Wildlife-Guide/Wild-Places/Great-Lakes
<br>
[2] US EPA, O. (2020, June 11). National Coastal Condition Assessment—Great Lakes Human Health Fish Tissue Studies [Overviews and Factsheets]. https://www.epa.gov/choose-fish-and-shellfish-wisely/national-coastal-
condition-assessment-great-lakes-human-health
<br>
[3] US EPA. (2024, April 9). 2020 Great Lakes Human Health Fish Fillet Tissue Study [Overviews and Factsheets]. https://www.epa.gov/choose-fish-and-shellfish-wisely/2020-great-lakes-human-health-fish-fillet-tissue-study
<br>
[4] EPA. (2020, June 15). Quality Assurance Project Plan for  National Coastal Condition Assessment (NCCA)  2020 Great Lakes Human Health Fish Sample Preparation.
<br>
[5] https://www.in.gov/health/eph/fish-consumption-advisory/contaminants-in-fish/
[6] https://www.epa.gov/sdwa/and-polyfluoroalkyl-substances-pfas
[7] https://synergies.oregonstate.edu/2013/excess-omega-3-fatty-acids-lead-negative-health-effects/

